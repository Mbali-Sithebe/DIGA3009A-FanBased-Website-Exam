<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simpsons API Test</title>

    <!-- GSAP For Animation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>

    <!-- Axios [for API calls] -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
  </head>
  <body>
    <h1>Simpsons API Test</h1>

    <header>
      <nav id="main-nav"></nav>
    </header>

    <!-- HTML placeholder -->
    <select id="episodeDropdown">
      <option value="">Select Episode</option>
    </select>
    <div id="episodes"></div>

    <script>
      /////////////////1. FETCHING DATA FROM THE SIMPSONS API ///////////////////////
      let charactersApiUrl = "https://thesimpsonsapi.com/api/characters";
      let episodesApiUrl = "https://thesimpsonsapi.com/api/episodes";

      // Fetching Characters Data
      axios
        .get(charactersApiUrl)
        .then((response) => {
          console.log("Characters raw:", response.data);

          // The API Returns an Array
          let charactersData =
            response.data.characters || response.data.results || [];

          charactersData.forEach((character) => {
            console.log(`Name: ${character.name}`);

            let randomPhrase = character.phrases
              ? character.phrases[
                  Math.floor(Math.random() * character.phrases.length)
                ]
              : "No phrases found";

            console.log(`Phrase: ${randomPhrase}`);
            console.log(`Image: ${character.portrait_path}`);
            console.log("-------------------------");
          });
        })
        // Testing if there are any errors
        .catch((error) => {
          console.error("Error fetching characters data:", error);
        });

      // Fetching The Episodes Data
      axios
        .get(episodesApiUrl)
        .then((response) => {
          console.log("Episodes raw:", response.data);

          // The API Returns an Array
          let episodesData =
            response.data.episodes || response.data.results || [];

          episodesData.forEach((episode) => {
            console.log(`Episode Number: ${episode.episode_number}`);
            console.log(`Title: ${episode.name}`);
            console.log(`Season: ${episode.season}`);
            console.log(`Synopsis: ${episode.synopsis}`);
            console.log(`Image: ${episode.image_path}`);
            console.log("-------------------------");
          });
        })
        // Testing if there are any errors
        .catch((error) => {
          console.error("Error fetching episodes data:", error);
        });

      /////////////////2. JAVASCRIPT GENERATED NAVIGATION BAR ///////////////////////

      // The root folder of my project
      const root = "/DIGA3009A-FanBased-Website-Exam";

      // Array of navigation bar using root variable
      const menuItems = [
        { name: "Home", href: `${root}/index.html` },
        { name: "About", href: `${root}/about/about.html` },
        { name: "Characters", href: `${root}/content/characters.html` },
        { name: "Episodes", href: `${root}/content/episodes.html` },
        { name: "Adaptation", href: `${root}/content/adaptation.html` },
      ];

      // Function to build the nav menu
      export function initialiseMenu() {
        const nav = document.getElementById("main-nav");
        const ul = document.createElement("ul");
        ul.classList.add("menu");

        // Get the current page filename
        const currentPage = window.location.pathname.split("/").pop();

        menuItems.forEach((item) => {
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = item.href;
          a.textContent = item.name;

          // Highlight current page in cyan
          const itemPage = item.href.split("/").pop(); // extract filename
          if (currentPage === itemPage) {
            a.style.color = "cyan";
            a.style.fontWeight = "bold"; // optional styling
          }

          li.appendChild(a);
          ul.appendChild(li);
        });

        nav.appendChild(ul);
      }

      // Call the function to render the menu
      initialiseMenu();

      //3.////////////////// SEARCHING/FILTERING EPISODES ///////////////////////////

      let episodes = [];

      // Fetch episodes from API
      async function fetchEpisodes() {
        const response = await fetch(
          "https://api.sampleapis.com/simpsons/episodes"
        );
        episodes = await response.json(); // convert API JSON data to JavaScript array
        displayEpisodes(episodes.slice(0, 10)); // show first 10 episodes
        populateDropdown();
      }

      // Display episodes
      function displayEpisodes(list) {
        const container = document.getElementById("episodes");
        container.innerHTML = list
          .map(
            (ep) => `
    <div>
      <h3>${ep.name}</h3>
      <p>Season ${ep.season}, Episode ${ep.number}</p>
    </div>
  `
          )
          .join("");
      }

      // Populate dropdown for filtering
      function populateDropdown() {
        const dropdown = document.getElementById("episodeDropdown");
        episodes.slice(0, 10).forEach((ep) => {
          const option = document.createElement("option");
          option.value = ep.id; // example unique identifier
          option.textContent = `Episode ${ep.number}: ${ep.name}`;
          dropdown.appendChild(option);
        });
      }

      // Filter episodes when dropdown changes
      document
        .getElementById("episodeDropdown")
        .addEventListener("change", (e) => {
          const selectedId = e.target.value;
          const filtered = episodes.filter((ep) => ep.id == selectedId);
          displayEpisodes(filtered);
        });

      // Initialize
      fetchEpisodes();
    </script>
  </body>
</html>
